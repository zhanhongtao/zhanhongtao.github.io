<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
  <title>Animation</title>
  <link rel="stylesheet" href="./animation.css">
</head>

<body>
  <h1>Animation</h1>

  <h2>CSS<div class="step-twitter-love"></div></h2>
  <dl>
    <dt>animation-name</dt>
    <dd>@keyframes 指定的关键帧名称。none 表示无动画。(不建议使用关键字做 name)</dd>
  </dl>
  <dl>
    <dt>animation-duration</dt>
    <dd>设置动画一周期的时长。[0]</dd>
  </dl>
  <dl>
    <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timing-function"target="_blank">animation-timing-function</a></dt>
    <dd>设置动画速度函数 - 动画在关键帧之间是如何变化。</dd>
    <dd>[ease]/linear/ease-in/ease-out/ease-in-out/<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/easing-function/cubic-bezier" target="_blank">cubic-bezier(x1, y1, x2, y2)</a>/<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/easing-function/linear" target="_blank">linear()</a></dd>
    <dd>step-start/step-end/steps(n,pos[jump-start|jump-end|jump-both|jump-none])/start[=steps(n, jump-start)]/end[=steps(n, jump-end)]</dd>
    <dd>jump-start: 跳过第一帧; jump-end: 跳过最后一帧; jump-body: 同时跳过第一和最后一帧; jump-none: 不跳过任何一帧</dd>
    <dd><div class="steps"></div></dd>
    <dd>可在 @keyframes 中不同时间段定义不同的 animation-timing-function - 自定义 (<mark>手写</mark>)</dd>
    <dd>DEMO: <div class="timing-function"></div></dd>
    <dd><a href="http://cubic-bezier.com" target="_blank">在线生成 cubic-bezier(x1, y1, x2, y2) 工具</a></dd>
    <dd><a href="https://linear-easing-generator.netlify.app/" target="_blank">在线生成 linear(...) 工具</a></dd>
  </dl>
  <dl>
    <dt>animation-delay</dt>
    <dd>设置延时，即从元素加载完成之后到动画序列开始执行的这段时间; 支持负值，表示从已运动 Math.abs(value) 时间时，元素应该所处位置开始; 同时，支持 s, ms 时间单位 [0]</dd>
    <dd>支持 inherit. [<mark>浏览器支持</mark>]</dd>
  </dl>
  <dl>
    <dt>animation-iteration-count</dt>
    <dd>设置动画重复次数，默认值是 1。[n | infinite]</dd>
  </dl>
  <dl>
    <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-direction">animation-direction</a></dt>
    <dd>设置动画在每次运行完后是反向运行还是重新回到开始位置重复运行。</dd>
    <dd>normal[default] | reverse | alternate | alternate-reverse</dd>
  </dl>
  <dl>
    <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-fill-mode">animation-fill-mode</a></dt>
    <dd>描述动画开始前/结束后，@keyframes 中定义的样式对元素本身样式的影响</dd>
    <dd>none 默认情况下，动画开始前 [animation-delay 这段时间] 和动画结束后，保留元素最初样式</dd>
    <dd>backwards 动画开始前，应用动画定义中的开始样式，动画结束后，回退到元素初始样式。受 animation-direction/animation-iteration-count 影响。单次情况下：direction
      为 normal/alternate 时，应用 from 样式; 为 reverse/alternate-reverse 时，应用 to 样式;</dd>
    <dd>forwards 动画开始前，保持元素最初样式，动画结束后，应用动画定义中的结束样式。当 animation-iteration-count 为 0 时，forwards 和 backwards 相同;</dd>
    <dd>both 同时使用 backwards 和 forwards 规则; 即：动画开始前应用动画定义中的开始样式，动画结束后应用动画定义中的结束样式</dd>
    <dd>ps: 添加 <code>animation-delay: 1s;</code> 看动画效果</dd>
  </dl>
  <dl>
    <dt>animation-play-state</dt>
    <dd>停止和恢复动画。[running | paused]</dd>
    <dd>
      <div class="play-state" id="animation-play-state"></div>
      <script>
        document.getElementById('animation-play-state').addEventListener('click', function (e) {
          const html = document.documentElement
          const property = '--play-state'
          const style = getComputedStyle(html)
          const s = style.getPropertyValue(property)
          html.style.setProperty(property, s === 'running' ? 'paused' : 'running')
        }, false);
      </script>
    </dd>
  </dl>
  <h3>简写形式</h3>
  <pre><code>animation: name duration function delay count direction fill-mode play-state;</code></pre>

  <div class="queen-grid">
    <div class="queen-wrap">
      <div class="queen queen-background"></div>
      background-position
    </div>
    <div class="queen-wrap">
      <div class="queen queen-translate">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/641/sprite_running-alice-queen.png" />
      </div>
      overflow: hidden + image + translateY
    </div>
    <div class="queen-wrap">
      <div class="queen queen-clip">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/641/sprite_running-alice-queen.png" />
      </div>
      object-view-clip
    </div>
  </div>

  <h3>动画合成</h3>
  <dl>
    <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-composition">animation-composition</a></dt>
    <dd>replace[default] 替换默认值</dd>
    <dd>accumulate 值累积</dd>
    <dd>add 效果累积</dd>
    <dd>
      <div class="composition composition-replace"></div>
      <div class="composition composition-accumulate"></div>
      <div class="composition composition-add"></div>
    </dd>
  </dl>

  <section class="animation-timeline">
    <h3>Animation Timeline <small><a href="https://caniuse.com/mdn-css_properties_animation-timeline">caniuse</a></small></h3>
    <dl>
      <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timeline">animation-timeline</a></dt>
      <dd>none</dd>
      <dd>auto[default] - <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentTimeline">DocumentTimeline</a></dd>
      <dd>--scroll-timeline-name, <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timeline/scroll">scroll()</a></dd>
      <dd>--view-timeline-name, <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timeline/view">view()</a></dd>

      <dt>animation-range-start</dt>
      <dd>动画开始位置</dd>
      <dd>normal[default][0%]/percentage/length</dd>
      <dd>view-timeline 情况下，还有额外几个值：cover/contain/entry/entry-crossing/exist/exist-crossing</dd>
      <dd><mark>重要提醒：subject 尺寸可能小于/等于/大于 viewport 尺寸</mark></dd>
      <dd>cover: subject 与 viewport 相交</dd>
      <dd>contain: subject 在视觉上完全包含/被包含 viewport</dd>
      <dd>常见情况是，subject 的尺寸小于 viewport 尺寸：entry/entry-crossing 的 100% 表示 subject 完全进入 viewport</dd>
      <dd>当 subject 的尺寸大于 viewport 尺寸时：entry 100% 表示 subject 刚好覆盖 viewport; entry-crossing 100% 表示 subject 完整穿过 entry 线</dd>
      <dd>可以在<a href="https://scroll-driven-animations.style/tools/view-timeline/ranges/" target="_blank">view-timeline-tool</a>查看效果</dd>

      <dt>animation-range-end</dt>
      <dd>动画结束位置，和 animation-range-start 对应</dd>

      <dt>上面两个属性的简写形式</dt>
      <dd><code>animation-range: animation-range-start animation-range-end</code></dd>
      <dd>当只有一个值时，第二个值为 normal</dd>
      <dd><code>animation-range: 20%</code> 相当于 <code>animation-range: 20% normal</code></dd>
    </dl>

    <h3>Scroll Timeline <small><a href="https://caniuse.com/mdn-css_properties_scroll-timeline">caniuse</a></small></h3>
    <dl>
      <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-timeline-name">scroll-timeline-name</a></dt>
      <dd>使用 css 中<a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/dashed-ident">自定义变量的命名方式</a>命名，用来标识当前具有滚动条的元素滚动进度作为 timeline 提供给 animation 使用</dd>

      <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-timeline-axis">scroll-timeline-axis</a></dt>
      <dd>元素可能在水平/垂直两个方向上都存在滚动条，因此需要指定使用哪个，默认使用逻辑属性 block</dd>
      <dd>block[default]/inline/x/y</dd>

      <dt>上面两个属性的简写形式</dt>
      <dd><code><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-timeline">scroll-timeline</a>: scroll-timeline-name scroll-timeline-axis;</code></dd>
      <dd>因为 scroll-timeline-axis 有默认值，可以忽略不写，只定义 timeline-name 即可</dd>
      <dd>
        <div class="scroller-wrap">
          <div class="scroller use-scroll-timeline-name" style="scroll-timeline-name: --scroll;">
            <div class="scroll-ani-element scroll-ani-element-inner" style="animation-timeline: --scroll"></div>
          </div>
        </div>
      </dd>

      <dt>scroll()</dt>
      <dd>按滚动条进度表示 timeline, 需要有可滚动的元素做 scroller，而 scroll() 函数提供简便方法，也就是匿名 scroll-timeline</dd>
      <dd>scroll(nearest[default]) 默认值，可以省略参数，意思是把最近具有滚动条的祖先元素做 scroller, 按它的滚动进度做 timeline</dd>
      <dd>scroll(root) 用文档的根元素做 scroller</dd>
      <dd>scroll(self) 元素自身做 scroller; ps: 尽管设置 overflow: hidden, 但如果内容使 scroller 存在 [隐藏滚动条] 时，同样可以让 animation 生效</dd>
      <dd>scroll(block[default]/inline/x/y)</dd>
      <dd>scroll(nearest, inline), scroll(x nearest) 关键字是固定的几个，位置舒徐可以任意写，都可以识别</dd>
      <dd>
        <div class="scroller-wrap">
          <div class="scroller use-scroll-fn">
            <div class="scroll-ani-element scroll-ani-element-inner" style="animation-timeline: scroll()"></div>
          </div>
        </div>
      </dd>
      <dd>
        <div class="scroller-wrap" style="position: relative">
          <div class="scroller scroll-ani-element-self">
            The scroll() CSS function can be used with animation-timeline to indicate a scrollable element (scroller)
            and scrollbar axis that will provide an anonymous scroll progress timeline for animating the current
            element. The scroll progress timeline is progressed through by scrolling the scroller between top and bottom
            (or left and right). The position in the scroll range is converted into a percentage of progress — 0% at the
            start and 100% at the end.
          </div>
          <div class="scroll-ani-element-help">
            <span class="scroll-ani-element-help-default">查看更多</span>
            <span class="scroll-ani-element-help-toggle">收起</span>
          </div>
        </div>
      </dd>
    </dl>

    <h3>View Timeline <small><a href="https://caniuse.com/mdn-css_properties_view-timeline">caniuse</a></small></h3>
    <p>属性的语义基本和 scroll-timeline 类似，定义名称和方向</p>
    <dl>
      <dt>view-timeline-name</dt>
      <dt>view-timeline-axis</dt>
      <dt>上面两个属性的简写形式</dt>
      <dd><code>view-timeline: view-timeline-name view-timeline-axis</code></dd>
      <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/view-timeline-inset" target="_blank">view-timeline-inset</a></dt>
      <dd>和 animation-range 作用类似，用于定义位置来计算 timeline; 和 scroll-padding 一样扩展 viewport 区间，定义 port 点</dd>
      <dt>view()</dt>
      <dd>可以理解成 view-timeline-axis 和 view-timeline-inset 的简写形式</dd>
    </dl>

    <h3>scope</h3>
    <dl>
      <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/timeline-scope" target="_blank">timeline-scope</a></dt>
      <dd>可以理解为，给元素定义好 view-timeline/scroll-timeline, 便于任意其他元素使用</dd>
      <dd>*-timeline-name 存在 scope 概念，只能作用于后代元素上</dd>
      <dd>可以在 *-timeline-name 元素的祖先元素上定义 timeline-scope: --custom-timeline-name 属性，意思是把 scope 向上提高，然后作用于更多后代元素上</dd>
      <dd>
        <div class="scroll-ani-element" style="position: fixed; top: 0; left: 0; animation-timeline: --scroll-scope"></div>
        <div class="scroller-wrap">
          <div class="scroller use-timeline-scope" style="scroll-timeline-name: --scroll-scope"></div>
        </div>
      </dd>
    </dl>
    <script>
      document.querySelector('.scroll-ani-element-help').addEventListener('click', function () {
        const scroller = document.querySelector('.scroll-ani-element-self')
        scroller.classList.toggle('scroll-ani-element-self-trigger')
      })
    </script>
  </section>

  <div class="scroller-wrap">
    <div class="view-scope"></div>
  </div>

  <h3>Multiple Animation</h3>
  <dl>
    <dt>语法：<code>animation: animation-defined[, animation-defined]*;</code></dt>
    <dd>单个动画不支持元素在同一时间内，不同属性使用不同 animation-timing-function. Multiple-Animation 可实现 (<mark>transform 不能组合使用，性能不佳</mark>)</dd>
    <dd>为了使用 transform 来实现曲线过程动画，可利用容器嵌套方法。见第三个例子。</dd>
    <dd>
      <div>
        <div class="mul-d0"></div>
        <div class="mul-d1"></div>
        <div class="mul-other"></div>
      </div>
    </dd>
  </dl>

  <h2>Animation Event</h2>
  <dl>
    <dt>animationstart</dt>
    <dd>event.animationName - @keyframe 名称</dd>
    <dd>event.elapsedTime - 动画开始与现在的时间间隔</dd>
    <dt>animationiteration</dt>
    <dt>animationend</dt>
    <dt>animationcancel</dt>
    <dt>查看开发者工具中 animation 相关事件</dt>
    <dd><a href="http://jsbin.com/silabe/2" target="_blank">JavaScript/UI 和 CSS 动画不在一个进程，即：相互不阻塞。</a></dd>
  </dl>

  <h3><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/offset#formal_syntax">offset</a> - 代替原 motion 语法</h3>
  <dl>
    <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/offset-anchor">offset-anchor</a></dt>
    <dd>定义相对位置关系</dd>
    <dd>auto = transform-origin</dd>
    <dd><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position_value">&lt;position&gt;</a></dd>

    <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/offset-path">offset-path</a></dt>
    <dd><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/ray">ray</a></dd>
    <dd>url</dd>
    <dd>circle/ellipse/inset/polygon/path/xywh/rect/shape - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/basic-shape">basic shape</a></dd>
    <dd>content-box/padding-box/border-box/fill-box/stroke-box/view-box - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/box-edge#values">box-edge</a></dd>

    <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/offset-distance">offset-distance</a></dt>
    <dd>定义在 path 上的偏移距离</dd>
    <dd>example: <code>offset-distance: 50%;</code></dd>

    <dt><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/offset-position">offset-position</a></dt>
    <dd>path 缺省起点位置 [example: ray(0deg); circle(80px)] 时，使用 offset-position 定义</dd>
    <dd>normal[default] = <code>50% 50%</code></dd>
    <dd>auto = <code>left top</code></dd>
    <dd><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position_value">&lt;position&gt;</a></dd>

    <dt><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/offset-rotate">offset-rotation</a></dt>
    <dd>auto - 从 x 轴正方向旋转到 path 方向的角度</dd>
    <dd>angle - 旋转固定角度 (ps: 向上是 0deg)</dd>
    <dd>auto &lt;angle&gt; - 在 auto 值基础上累加 angle 值得到最终旋转角度</dd>
    <dd>reverse - <code>auto 180deg</code></dd>

    <dt>定义 animation - 见上面，定义@keyframes.</dt>
    <dd>
      <code>
        @keyframes {
          from {
            offset-distance: 0%;
          }
          to {
            offset-distance: 100%;
          }
        }
      </code>
    </dd>
    <dt>DEMO:</dt>
    <dd>
      <div class="motion-box">
        <svg viewBox="0 0 502 202" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M1,1 C1,1 185.123623,304.688377 263.645528,163.624677 C342.167432,22.5609775 428.948967,25.6679009 501,132.967244" id="Path" stroke="#979797" stroke-width="1" fill="none"></path>
        </svg>
        <div class="offset-item offset-item-path"></div>
        <div class="offset-item offset-item-ray"></div>
        <div class="offset-item offset-item-box"></div>
        <div class="offset-item offset-item-rect"></div>
        <div class="offset-item offset-item-inset"></div>
        <div class="offset-item offset-item-circle"></div>
        <div class="offset-item offset-item-xywh"></div>
      </div>
    </dd>
  </dl>

  <h2>JavaScript Animation</h2>
  <style>
    /*
      * from[0%]/to[100%]
        from[0%] 可省略，使用元素当前状态
        to[100%] 也可省略，使用元素动画前状态
      * 不是所有属性都支持动画
    */
    @keyframes slide {
      100% {
        translate: 200px 0;
      }
    }
    #demo {
      margin: 10px 0;
      width: 48px;
      height: 48px;
      border-radius: 4px;
      background-color: #faa;
    }
    .enable {
      animation: slide 1.5s ease infinite alternate forwards;
      animation-play-state: var(--play-state);
    }
  </style>
  <button id="add">Add</button>
  <button id="pause">Pause</button>
  <button id="resume">Resume</button>
  <button id="remove">Remove</button>
  <div id="demo"></div>

  <div id="logo-sogou-demo" style="display: none;">
    <div class="logo-sogou-wrap">
      <div class="logo-sogou"></div>
    </div>
  </div>
  <script>
    var demo = document.getElementById('demo');
    demo.addEventListener('animationstart', function (e) {
      console.log('animation-start:', e);
    }, false);
    demo.addEventListener('animationend', function (e) {
      console.log('animation-end:', e);
    }, false);
    demo.addEventListener('animationiteration', function (e) {
      console.log('animation-iteration:', e);
    }, false);
    demo.addEventListener('animationcancel', function (e) {
      console.log('animation-iteration:', e);
    }, false);

    document.getElementById('add').addEventListener('click', function (e) {
      demo.classList.add('enable');
      demo.style.setProperty('--play-state', 'running')
    }, false);
    document.getElementById('remove').addEventListener('click', function (e) {
      demo.classList.remove('enable');
    }, false);
    document.getElementById('pause').addEventListener('click', function (e) {
      demo.style.setProperty('--play-state', 'paused')
    }, false);
    document.getElementById('resume').addEventListener('click', function (e) {
      demo.style.setProperty('--play-state', 'running')
    }, false);

    var logo = document.getElementById('logo-sogou-demo');
    if (location.search.indexOf('hi=921') > -1) {
      logo.style.display = '';
    }
  </script>

  <h2>相关文档/链接</h2>
  <ul>
    <li><a href="https://www.w3.org/TR/css3-animations/" target="_blank">https://www.w3.org/TR/css3-animations/</a></li>
    <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/dashed-ident">&lt;dashed-ident&gt;</a></li>
    <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_scroll-driven_animations">CSS scroll-driven
        animations</a></li>
    <li><a href="https://scroll-driven-animations.style/">scroll-driven-animations</a></li>
    <li><a
        href="https://slidr.io/bramus/scroll-driven-animations-and-view-transitions-2023-06-09-css-day#1">scroll-driven-animations-and-view-transitions</a>
    </li>
    <li><a href="https://github.com/flackr/scroll-timeline?tab=readme-ov-file">scroll-timeline</a></li>
    <li><a href="https://yuanchuan.dev/time-based-css-animations">Time based css animations</a></li>
    <li><a href="https://css-tip.com/css-variables-range-slider/">Update CSS variables using range slider</a></li>
    <li><a href="https://frontendmasters.com/blog/how-to-get-the-width-height-of-any-element-in-only-css/">How to Get
        the Width/Height of Any Element in Only CSS</a></li>
    <li><a href="https://chrome.dev/css-wrapped-2024/">CSS Wrapped 2024</a></li>
    <li><a href="https://css-tricks.com/create-a-responsive-css-motion-path-sure-we-can/">Create a Responsive CSS Motion
        Path? Sure We Can!</a></li>
  </ul>
</body>

</html>
